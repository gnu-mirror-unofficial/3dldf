   Point p0;
   Point p1;
   Point normal;
   Transform t;
   Path p;
   Path R;

   Connector_Type *c = 0;

   stringstream temp_strm;

   int status = 0;


   close(fd_out);
   fd_out = 0;

@q **** (4) @>
@
@<Define utility functions@>=
    
   if (do_ampersand)
   {
       /* !! TODO:  LDF 2022.04.20.  Add code.  Something will have to be written to
          `temp_strm' so it will be executed in `3DLDF_resolve_bottom.mp'."
       */

   }  /* |if (do_ampersand)| */

@q **** (4) @>
@
@<Define utility functions@>=

  temp_strm << "%% " << temp_in_filename << endl
            << "%% Generated by GNU 3DLDF " << buffer
            << endl
            << "input 3DLDF_resolve_top.mp;" << endl 
            << endl 
            << "extern = false; % true " << endl 
            << endl 
            << "if extern:" << endl 
            << "  tracingonline := 1;" << endl 
            << "fi" << endl 
            << endl 
            << "begin_val = " << begin   << ";" << endl 
            << "end_val = "   << end     << ";" << endl 
            << "res_val = "   << res_val << ";" << endl 
            << "output_filename = \"" << temp_out_filename << "\";"  << endl 
            << endl 
            << "Q0 = " << *this << ";" << endl 
            << endl 
            << "input 3DLDF_resolve_bottom.mp;" << endl 
            << endl 
            << "%% Local Variables:" << endl 
            << "%% mode:MetaPost"    << endl 
            << "%% End:"             << endl 
            << endl;

   memset(buffer, '\0', 64);

#if DEBUG_COMPILE
   if (DEBUG)
   { 
      cerr << "In `call_metapost':  `temp_strm.str' == " 
           << endl
           << temp_strm.str();
   }  
#endif /* |DEBUG_COMPILE|  */@; 

@q **** (4) @>
@
@<Define utility functions@>=

@q **** (4) @>
@
@<Define utility functions@>=

  temp_strm.str("");



  /*  << " >/dev/null 2>/dev/null";  */

#if 0 
  cerr << "temp_strm.str() == " << temp_strm.str() << endl;
#endif 

  errno = 0;

@q **** (4) @>
@
@<Define utility functions@>=

   errno = 0;   
   fp = 0 ;
   fp = fopen(temp_out_filename, "r");

   if (fp == 0)
   {
      cerr << "ERROR!  In `call_metapost':  `fopen' failed, returning 0:"
           << endl
           << "`errno' == " << errno << ":  " << strerror(errno)
           << endl
           << "Exiting function unsuccessfully with return value 1."
           << endl;

            return 1;

   } /* |if (fp == 0)| */

@q **** (4) @>

#if DEBUG_COMPILE
   else if (DEBUG)
   { 
      cerr << "In `call_metapost':  `fopen' succeeded."
           << endl;
   }  
#endif /* |DEBUG_COMPILE|  */@; 

   if (scanner_node->metapost_output_struct == 0)
      scanner_node->metapost_output_struct = new Metapost_Output_Struct;

   scanner_node->metapost_output_struct->path_vector.clear();

   scanner_node->metapost_output_struct->real_vector.clear();

   yyscan_t scanner;
   zzlex_init_extra(static_cast<void*>(scanner_node),  &scanner);
   zzset_in(fp, scanner);
   zzlex(scanner);
   zzlex_destroy(scanner);

   fclose(fp);
   fp = 0;

#if DEBUG_COMPILE
   if (DEBUG)
   { 
      cerr << "In `call_metapost':  After calling zzlex." << endl;

      cerr << "scanner_node->metapost_output_struct->path_vector.size() == " 
           << scanner_node->metapost_output_struct->path_vector.size() 
           << endl
           << "scanner_node->metapost_output_struct->real_vector.size() == " 
           << scanner_node->metapost_output_struct->real_vector.size() << endl;

      for (vector<Path*>::iterator iter = scanner_node->metapost_output_struct->path_vector.begin();
           iter != scanner_node->metapost_output_struct->path_vector.end();
           ++iter)
      {
         (**iter).show("**iter:");
      }
   }  
#endif /* |DEBUG_COMPILE|  */@; 

@q **** (4) @>
@
@<Define utility functions@>=

   if (do_unlink)
   {
      unlink(temp_in_filename);
      unlink(temp_out_filename);
      unlink(temp_log_filename);
   }

@q **** (4) @>
@
@<Define utility functions@>=

   for (vector<Path*>::iterator iter = scanner_node->metapost_output_struct->path_vector.begin();
        iter != scanner_node->metapost_output_struct->path_vector.end();
        ++iter)
   {
       pv->v.push_back(*iter);
   }

   scanner_node->metapost_output_struct->path_vector.clear();
   scanner_node->metapost_output_struct->real_vector.clear();


#if DEBUG_COMPILE
   if (DEBUG)
   { 
       cerr << "Exiting `call_metapost' successfully with return value 0."
            << endl;
   }  
#endif /* |DEBUG_COMPILE|  */@; 

   return 0;

}  /* End of |call_metapost| definition  */

@q Local Variables: @>
@q mode:CWEB @>
@q eval:(display-time) @>
@q indent-tabs-mode:nil @>
@q eval:(outline-minor-mode) @>
@q End: @>
