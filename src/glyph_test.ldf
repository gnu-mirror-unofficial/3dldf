%% glyph_test.ldf
%% Created by Laurence D. Finston (LDF) Wed 06 Apr 2022 10:50:52 PM CEST

input "plain.lmc";

verbatim_metapost "prologues := 3; outputtemplate := \"%j%3c.eps\";";

glyph g;
glyph h;
glyph t;

%% * (1)

numeric frame_wd;
numeric frame_ht;
frame_wd := 18cm;
frame_ht := 20cm;

path frame;

frame :=    (-.5frame_wd, -.5frame_ht) -- (.5frame_wd, -.5frame_ht) -- (.5frame_wd, .5frame_ht)
         -- (-.5frame_wd, .5frame_ht) -- cycle;


focus f;
set f with_position (0, 15, -10) with_direction (0, 15, 10) with_distance 10;

path_vector pv;
point p[][];
path q[];
transform t[];

%% * (1) Fig. 0.
  
beginfig(0);

%% ** (2)
  
  draw frame shifted (5cm, 5cm);
  
  dotlabel.bot("origin", origin);
  
  g := get_glyph 65 from "cmssbx10";

  scale g by .5; 
  
  % message "g:";
  % show g;

  %draw g;
  
  pv := get_paths from g;

  % message "Before resolve.";
  % message "length pv0:";
  % show length pv0;

  %resolve pv0 to 500 with_no_transform;
  
  resolve pv0 (0, 1) to 6 with_no_transform;
  resolve pv0 (8, 9) to 6 with_no_transform;
  resolve pv0 (17, 18) to 6 with_no_transform;
  resolve pv0 (24, 25) to 6 with_no_transform;
  resolve pv0 (34, 35) to 6 with_no_transform;
  resolve pv0 (41, 42) to 6 with_no_transform;

  replace connector 7 pv0 with "--";
  replace connector 15 pv0 with "--";
  replace connector 23 pv0 with "--";
  replace connector 31 pv0 with "--";
  replace connector 40 pv0 with "--";
  replace connector 49 pv0 with "--";

  %label("47", get_point (47) pv0) with_text_color blue; 
  
  
  
  % resolve pv0 (2, 3) to 6 with_no_transform;
  % resolve pv0 (4, 6) to 6 with_no_transform;
  % resolve pv0 (7, 8) to 6 with_no_transform;
  % resolve pv0 (11, 12) to 6 with_no_transform;
  % resolve pv0 (13, 15) to 6 with_no_transform;

  message "pv0:";
  show pv0 with_connectors 3;
  %pause;
  
  draw pv0;
  draw pv1;

endfig with_projection parallel_x_y;


%% * (1) Fig. 1.

beginfig(1);

%% ** (2)

  draw frame shifted (5cm, -10cm);

  output current_picture with_projection parallel_x_y;
  clear current_picture;
  
  q0 := pv0 rotated (-90, 0);
  q1 := pv1 rotated (-90, 0);

  n := (length q0) - 1;

  string s;
  
  for i = 0 upto n:
    p[0][i] := get_point (i) q0;
    %s := decimal i;
    %dotlabel.top(s, p[0][i]);
  endfor;
  
  n := (length pv1) - 1;
  
  for i = 0 upto n:
    p[1][i] := get_point (i) pv1;
    %s := decimal i;
    %dotlabel.top(s, p[1][i]);
  endfor;


  dotlabel.top("7", p[0][7]);
  dotlabel.top("8", p[0][8]);

  dotlabel.lft("15", p[0][15]);
  dotlabel.lft("16", p[0][16]);

  dotlabel.bot("23", p[0][23]);
  dotlabel.lrt("24", p[0][24]);

  dotlabel.rt("31", p[0][31]);
  dotlabel.lrt("32", p[0][32]);
  dotlabel.llft("33", p[0][33]);
  %dotlabel.lft("34", p[0][34]);
  %dotlabel.lft("35", p[0][35]);
  dotlabel.lft("36", p[0][36]);
  %dotlabel.lft("37", p[0][37]);

  dotlabel.bot("40", p[0][40]);
  dotlabel.bot("41", p[0][41]); 

  dotlabel.rt("49", p[0][49]); 
  dotlabel.top("0", p[0][0]);

  % dotlabel.lrt("$p_0^{20}$", p[0][20]);
  % dotlabel.lrt("$p_0^{30}$", p[0][30]);
  % dotlabel.lrt("$p_0^{40}$", p[0][40]);
  % dotlabel.lrt("$p_0^{45}$", p[0][45]);
  % dotlabel.rt("$p_0^{49}$", p[0][49]);

  % dotlabel.urt("$p_0^1$", p[0][1]);
  % dotlabel.top("$p_0^2$", p[0][2]);
  % dotlabel.lft("$p_0^3$", p[0][3]);
  % dotlabel.ulft("$p_0^4$", p[0][4]);
  % dotlabel.lft("$p_0^5$", p[0][5]);
  % dotlabel.bot("$p_0^6$", p[0][6]);
  % dotlabel.bot("$p_0^7$", p[0][7]);
  % dotlabel.bot("$p_0^8$", p[0][8]);
  % dotlabel.lrt("$p_0^9$", p[0][9]);
  % dotlabel.llft("$p_0^{10}$", p[0][10]);
  % dotlabel.lft("$p_0^{11}$", p[0][11]);
  % dotlabel.bot("$p_0^{12}$", p[0][12]);
  % dotlabel.bot("$p_0^{13}$", p[0][13]);
  % dotlabel.rt("$p_0^{14}$", p[0][14]);
  % dotlabel.urt("$p_0^{15}$", p[0][15]);
  % dotlabel.urt("$p_0^{16}$", p[0][16]);
  % dotlabel.urt("$p_0^{17}$", p[0][17]);
  % dotlabel.urt("$p_0^{18}$", p[0][18]);
  % dotlabel.urt("$p_0^{19}$", p[0][19]);
  %dotlabel.top("$p_0^{20}$", p[0][20]);
  % dotlabel.top("$p_0^{21}$", p[0][21]);
  
  
  % dotlabel.lft("$p_1^0$", p[1][0]);
  % dotlabel.lft("$p_1^1$", p[1][1]);
  % dotlabel.rt("$p_1^2$", p[1][2]);
  % dotlabel.rt("$p_1^3$", p[1][3]);
  % dotlabel.rt("$p_1^4$", p[1][4]);
  % dotlabel.lft("$p_1^5$", p[1][5]);

  %% !! START HERE: LDF 2022.04.06.  Make this work.  The function
  %% exists, I just need the parser rule.
  
  %message "connectors (34, 40) q0:";
  %show connectors (34, 40) q0;
  %pause;

  %replace connectors q0 with "..";

  draw q0;
  draw q1;

  t0 := identity shifted (0, 2cm);

  q2 := q0 transformed t0;
  q3 := q1 transformed t0;
  
  draw q2;
  draw q3;

  n := (length q2) - 1;
  
  for i = 0 upto n:
    p[2][i] := get_point (i) q2;
    %s := decimal i;
    %dotlabel.top(s, p[1][i]);
  endfor;

  n := (length q3) - 1;
  
  for i = 0 upto n:
    p[3][i] := get_point (i) q3;
    %s := decimal i;
    %dotlabel.top(s, p[1][i]);
  endfor;

  draw p[0][0] -- p[2][0];
  draw p[0][7] -- p[2][7];
  draw p[0][8] -- p[2][8];
  draw p[0][15] -- p[2][15];
  draw p[0][16] -- p[2][16];
  draw p[0][23] -- p[2][23];
  draw p[0][24] -- p[2][24];
  draw p[0][31] -- p[2][31];
  draw p[0][32] -- p[2][32];
  draw p[0][33] -- p[2][33];
  draw p[0][40] -- p[2][40];
  draw p[0][41] -- p[2][41];
  draw p[0][49] -- p[2][49];

  % draw get_point (32) pv0 -- get_point (32) q2;
  % draw get_point (33) pv0 -- get_point (33) q2;
  % draw get_point (40) pv0 -- get_point (40) q2;
  
  unfilldraw p[0][32] -- p[0][33] -- p[2][33] -- p[2][32] -- cycle;
  unfill q2;

  draw q3;

  
  pen big_pen;
  big_pen := pencircle scaled (2mm, 2mm, 2mm);

  draw q2;
  draw q3; %withcolor blue withpen big_pen;
  
  % draw get_point (0) pv0 .. get_point (1) pv0 .. get_point (2) pv0 .. get_point (3) pv0
  %   with_color blue with_pen pencircle scaled (1mm, 1mm); %  rotated (-45, 0)
  
%% ** (2) End of fig. 1

%endfig with_projection parallel_x_y;
endfig with_focus f no_sort;

%% * (1)

end_mp;
end;


%% Local Variables:
%% mode: MetaPost
%% eval:(outline-minor-mode t)
%% outline-regexp:"%% [*\f]+"
%% End:
